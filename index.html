<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA Conversationnelle</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #chat { border: 1px solid #ccc; padding: 10px; max-height: 400px; overflow-y: scroll; }
        .message { margin: 5px 0; }
        .user { font-weight: bold; }
        .ai { color: green; }
        input[type="text"] { width: calc(100% - 22px); padding: 10px; }
        button { padding: 10px; }
    </style>
</head>
<body>
    <h1>Interagissez avec l'IA</h1>
    <div id="chat"></div>
    <input type="text" id="userInput" placeholder="Tapez votre question..." />
    <button onclick="sendMessage()">Envoyer</button>

    <script>
        const GITHUB_TOKEN = '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'; // Remplacez par votre token GitHub
        const GIST_URL = 'https://api.github.com/gists/9fda467fa7fd887d33b6640dee366042'; // Remplacez par l'URL de votre Gist
        let responses = {};

        // Charger les réponses depuis le Gist
        async function loadResponses() {
            try {
                const response = await fetch(GIST_URL, {
                    method: 'GET',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) throw new Error('Erreur lors du chargement des réponses.');

                const gistData = await response.json();
                const fileContent = gistData.files["data.json"].content;
                responses = JSON.parse(fileContent);
            } catch (error) {
                console.error('Erreur dans loadResponses:', error);
            }
        }

        // Envoyer un message à l'IA
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const userMessage = input.value.trim();
            if (userMessage === '') return;

            appendMessage('Vous: ' + userMessage, 'user');
            input.value = '';

            const response = getResponse(userMessage);
            appendMessage('IA: ' + response.message, 'ai');

            if (response.isSimilar) {
                await askForConfirmation(response.message, userMessage);
            } else if (response.isNew) {
                await askForNewResponse(userMessage);
            }
        }

        // Fonction pour obtenir la réponse de l'IA
        function getResponse(question) {
            question = question.toLowerCase();
            let isSimilar = false;
            let isNew = true;
            let message = '';

            for (const key in responses) {
                if (key.toLowerCase() === question) {
                    message = responses[key];
                    isNew = false;
                    break;
                } else if (key.toLowerCase().includes(question) || question.includes(key.toLowerCase())) {
                    message = responses[key];
                    isSimilar = true;
                    break;
                }
            }

            return { message, isSimilar, isNew };
        }

        // Demander confirmation pour les réponses similaires
        async function askForConfirmation(responseMessage, question) {
            const confirmation = confirm(`L'IA a répondu : "${responseMessage}". Est-ce correct ?`);
            if (!confirmation) {
                await askForNewResponse(question);
            }
        }

        // Demander la nouvelle réponse à sauvegarder
        async function askForNewResponse(question) {
            const newResponse = prompt(`Quelle est la bonne réponse pour "${question}" ?`);
            if (newResponse) {
                responses[question.toLowerCase()] = newResponse;
                await updateGist();
                appendMessage('IA: Réponse sauvegardée !', 'ai');
            }
        }

        // Mettre à jour le Gist avec les nouvelles réponses
        async function updateGist() {
            const updatedContent = JSON.stringify(responses, null, 2);
            try {
                const response = await fetch(GIST_URL, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        files: {
                            "data.json": {
                                content: updatedContent
                            }
                        }
                    })
                });

                if (!response.ok) throw new Error('Erreur lors de la mise à jour du Gist.');

                console.log('Réponse mise à jour avec succès dans le Gist.');
            } catch (error) {
                console.error('Erreur dans updateGist:', error);
            }
        }

        // Ajouter un message au chat
        function appendMessage(message, className) {
            const chat = document.getElementById('chat');
            const messageElement = document.createElement('div');
            messageElement.className = 'message ' + className;
            messageElement.textContent = message;
            chat.appendChild(messageElement);
            chat.scrollTop = chat.scrollHeight; // Faire défiler vers le bas
        }

        // Charger les réponses au chargement de la page
        window.onload = loadResponses;
    </script>
</body>
</html>
